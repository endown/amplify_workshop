[{"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\reportWebVitals.js":"1","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\App.js":"2","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\aws-exports.js":"3","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\index.js":"4","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\AllPosts.js":"5","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\graphql\\queries.js":"6","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\graphql\\subscriptions.js":"7","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\PostsBySpecifiedUser.js":"8","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\Timeline.js":"9","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\Sidebar.js":"10","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\Search.js":"11","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\graphql\\mutations.js":"12","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\components\\PostList.js":"13"},{"size":362,"mtime":1606289644680,"results":"14","hashOfConfig":"15"},{"size":2800,"mtime":1612255969552,"results":"16","hashOfConfig":"15"},{"size":692,"mtime":1612195692543,"results":"17","hashOfConfig":"15"},{"size":500,"mtime":1606289644680,"results":"18","hashOfConfig":"15"},{"size":2275,"mtime":1611612122690,"results":"19","hashOfConfig":"15"},{"size":3545,"mtime":1612193073416,"results":"20","hashOfConfig":"15"},{"size":1102,"mtime":1612193073767,"results":"21","hashOfConfig":"15"},{"size":4304,"mtime":1611624445141,"results":"22","hashOfConfig":"15"},{"size":2735,"mtime":1612158231202,"results":"23","hashOfConfig":"15"},{"size":4927,"mtime":1612164775809,"results":"24","hashOfConfig":"15"},{"size":2990,"mtime":1612164707323,"results":"25","hashOfConfig":"15"},{"size":1870,"mtime":1612193073598,"results":"26","hashOfConfig":"15"},{"size":3587,"mtime":1611612193781,"results":"27","hashOfConfig":"15"},{"filePath":"28","messages":"29","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},"p0weh6",{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"36","messages":"37","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"38","messages":"39","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"40","messages":"41","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"42","messages":"43","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"44","messages":"45","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"46","usedDeprecatedRules":"35"},{"filePath":"47","messages":"48","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"49","messages":"50","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"51","messages":"52","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"35"},{"filePath":"53","messages":"54","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"55","messages":"56","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\reportWebVitals.js",[],["57","58"],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\App.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\aws-exports.js",[],["59","60"],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\index.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\AllPosts.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\graphql\\queries.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\graphql\\subscriptions.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\PostsBySpecifiedUser.js",["61","62","63"],"import React, { useState, useEffect, useReducer } from 'react';\r\n\r\nimport API, { graphqlOperation } from '@aws-amplify/api';\r\nimport Auth from '@aws-amplify/auth';\r\nimport { useParams, useHistory } from 'react-router';\r\nimport { Box, Button} from '@material-ui/core';\r\n\r\nimport { listPostsBySpecificOwner, getFollowRelationship } from '../graphql/queries';\r\nimport { onCreatePost } from '../graphql/subscriptions';\r\nimport { createFollowRelationship, deleteFollowRelationship } from '../graphql/mutations';\r\nimport PostList from '../components/PostList';\r\nimport Sidebar from './Sidebar';\r\n\r\nconst SUBSCRIPTION = 'SUBSCRIPTION';\r\nconst INITIAL_QUERY = 'INITIAL_QUERY';\r\nconst ADDITIONAL_QUERY = 'ADDITIONAL_QUERY';\r\n\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case INITIAL_QUERY:\r\n      return action.posts;\r\n    case ADDITIONAL_QUERY:\r\n      return [...state, ...action.posts]\r\n    case SUBSCRIPTION:\r\n      return [action.post, ...state]\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default function PostsBySpecifiedUser() {\r\n  const { userId } = useParams();\r\n\r\n  const [posts, dispatch] = useReducer(reducer, []);\r\n  const [nextToken, setNextToken] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [isFollowing, setIsFollowing] = useState(false);\r\n\r\n  const getPosts = async (type, nextToken = null) => {\r\n    const res = await API.graphql(graphqlOperation(listPostsBySpecificOwner, {\r\n      owner: userId,\r\n      sortDirection: 'DESC',\r\n      limit: 20, //default = 10\r\n      nextToken: nextToken,\r\n    }));\r\n    console.log(res);\r\n    dispatch({ type: type, posts: res.data.listPostsBySpecificOwner.items })\r\n    setNextToken(res.data.listPostsBySpecificOwner.nextToken);\r\n    setIsLoading(false);\r\n  }\r\n\r\n  const getIsFollowing = async ({followerId, followeeId}) => {\r\n    const res = await API.graphql(graphqlOperation(getFollowRelationship,{\r\n      followeeId: followeeId,\r\n      followerId: followerId,\r\n    }));\r\n    console.log(res)\r\n    return res.data.getFollowRelationship !== null\r\n  }\r\n\r\n  const getAdditionalPosts = () => {\r\n    if (nextToken === null) return; //Reached the last page\r\n    getPosts(ADDITIONAL_QUERY, nextToken);\r\n  }\r\n\r\n  const follow = async () => {\r\n    console.log('follow')\r\n    const input = {\r\n      followeeId: userId,\r\n      followerId: currentUser.username,\r\n      timestamp: Date.now(),\r\n    }\r\n    const res = await API.graphql(graphqlOperation(createFollowRelationship, {input: input}));\r\n    if(!res.data.createFollowRelationship.erros) setIsFollowing(true);\r\n    console.log(res);\r\n  }\r\n\r\n  const unfollow = async() => {\r\n    console.log('unfollow');\r\n    const input = {\r\n      followeeId: userId,\r\n      followerId: currentUser.username,\r\n    }\r\n    const res = await API.graphql(graphqlOperation(deleteFollowRelationship,{input: input}));\r\n\r\n    if(!res.data.deleteFollowRelationship.erros) setIsFollowing(false);\r\n    console.log(res)\r\n  }\r\n\r\n  useEffect(() => {\r\n    const init = async() => {\r\n      const currentUser = await Auth.currentAuthenticatedUser();\r\n      setCurrentUser(currentUser);\r\n\r\n      setIsFollowing(await getIsFollowing({followeeId: userId, followerId: currentUser.username}));\r\n\r\n      getPosts(INITIAL_QUERY);\r\n    }\r\n    init()\r\n\r\n    const subscription = API.graphql(graphqlOperation(onCreatePost)).subscribe({\r\n      next: (msg) => {\r\n        const post = msg.value.data.onCreatePost;\r\n        if (post.owner !== userId) return;\r\n        dispatch({ type: SUBSCRIPTION, post: post });\r\n      }\r\n    });\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Sidebar \r\n        activeListItem='profile'\r\n      />\r\n      <PostList\r\n        isLoading={isLoading}\r\n        posts={posts}\r\n        getAdditionalPosts={getAdditionalPosts}\r\n        listHeaderTitle={userId}\r\n        listHeaderTitleButton={\r\n          ( currentUser && userId !== currentUser.username ) &&\r\n          ( isFollowing ? \r\n            <Button  variant='contained' color='primary' onClick={unfollow}>Following</Button> \r\n          :\r\n            <Button variant='outlined' color='primary' onClick={follow}>Follow</Button> \r\n          )\r\n        }\r\n      />\r\n    </React.Fragment>\r\n  )\r\n}","C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\Timeline.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\Sidebar.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\containers\\Search.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\graphql\\mutations.js",[],"C:\\Users\\endo\\webapp\\AWS_Amplify\\amplify-sns-workshop\\boyaki\\src\\components\\PostList.js",[],{"ruleId":"64","replacedBy":"65"},{"ruleId":"66","replacedBy":"67"},{"ruleId":"64","replacedBy":"68"},{"ruleId":"66","replacedBy":"69"},{"ruleId":"70","severity":1,"message":"71","line":5,"column":21,"nodeType":"72","messageId":"73","endLine":5,"endColumn":31},{"ruleId":"70","severity":1,"message":"74","line":6,"column":10,"nodeType":"72","messageId":"73","endLine":6,"endColumn":13},{"ruleId":"75","severity":1,"message":"76","line":110,"column":6,"nodeType":"77","endLine":110,"endColumn":8,"suggestions":"78"},"no-native-reassign",["79"],"no-negated-in-lhs",["80"],["79"],["80"],"no-unused-vars","'useHistory' is defined but never used.","Identifier","unusedVar","'Box' is defined but never used.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'getPosts' and 'userId'. Either include them or remove the dependency array.","ArrayExpression",["81"],"no-global-assign","no-unsafe-negation",{"desc":"82","fix":"83"},"Update the dependencies array to be: [getPosts, userId]",{"range":"84","text":"85"},[3656,3658],"[getPosts, userId]"]